#!/usr/bin/env python3
"""–°–∫—Ä–∏–ø—Ç –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å flow –∏ —Å—Å—ã–ª–∫–∞–º–∏ —Å —Å–∞–π—Ç–∞ ihearyou.ru."""

import asyncio
import os
import sys
from typing import Any, Dict, List

from sqlalchemy import delete, select


sys.path.append(os.path.dirname(os.path.dirname(os.path.abspath(__file__))))

from backend.core.db import AsyncSessionLocal
from backend.crud import ContentFileCRUD, MenuItemCRUD
from backend.models.content_file import ContentFile
from backend.models.enums import AccessLevel, ContentType
from backend.models.menu_item import MenuItem


class FlowDataLoader:
    """–ö–ª–∞—Å—Å –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å flow."""

    def __init__(self):
        """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑—á–∏–∫–∞ –¥–∞–Ω–Ω—ã—Ö."""
        self.menu_crud = MenuItemCRUD()
        self.content_crud = ContentFileCRUD()

    async def clear_existing_data(self, session):
        """–û—á–∏—Å—Ç–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ."""
        print("üßπ –û—á–∏—Å—Ç–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö...")

        # –£–¥–∞–ª—è–µ–º –≤—Å–µ –∫–æ–Ω—Ç–µ–Ω—Ç–Ω—ã–µ —Ñ–∞–π–ª—ã
        await session.execute(delete(ContentFile))

        # –£–¥–∞–ª—è–µ–º –≤—Å–µ –ø—É–Ω–∫—Ç—ã –º–µ–Ω—é
        await session.execute(delete(MenuItem))

        await session.commit()
        print("‚úÖ –î–∞–Ω–Ω—ã–µ –æ—á–∏—â–µ–Ω—ã")

    async def create_main_menu_items(self, session):
        """–°–æ–∑–¥–∞—Ç—å –æ—Å–Ω–æ–≤–Ω—ã–µ –ø—É–Ω–∫—Ç—ã –º–µ–Ω—é - 2 –¥–∏–Ω–∞–º–∏—á–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ –ø–æ—Å–ª–µ /start."""
        print("üìã –°–æ–∑–¥–∞–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω—ã—Ö –ø—É–Ω–∫—Ç–æ–≤ –º–µ–Ω—é...")

        main_items = [
            {
                "title": "–Ø –≤–æ–ª–Ω—É—é—Å—å –æ —Å–ª—É—Ö–µ —Ä–µ–±–µ–Ω–∫–∞",
                "description": "–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–ª—è —Ä–æ–¥–∏—Ç–µ–ª–µ–π –¥–µ—Ç–µ–π —Å –Ω–∞—Ä—É—à–µ–Ω–∏–µ–º —Å–ª—É—Ö–∞",
                "bot_message": "–ü–æ–Ω–∏–º–∞–Ω–∏–µ –≤–∞—à–∏—Ö –±–µ—Å–ø–æ–∫–æ–π—Å—Ç–≤. –î–∞–≤–∞–π—Ç–µ —Ä–∞–∑–±–µ—Ä–µ–º, —á—Ç–æ –≤–∞—Å –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç:",
                "content": "üë∂ **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–ª—è —Ä–æ–¥–∏—Ç–µ–ª–µ–π**\n\n–ú—ã –ø–æ–Ω–∏–º–∞–µ–º, –∫–∞–∫ –≤–∞–∂–Ω–æ –¥–ª—è –≤–∞—Å –ø–æ–º–æ—á—å —Å–≤–æ–µ–º—É —Ä–µ–±–µ–Ω–∫—É. –ù–∞ –Ω–∞—à–µ–º —Å–∞–π—Ç–µ –≤—ã –Ω–∞–π–¥–µ—Ç–µ:\n\n‚Ä¢ **–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –¥–ª—è —Ä–æ–¥–∏—Ç–µ–ª–µ–π** - https://www.ihearyou.ru/\n‚Ä¢ **–ú–∞—Ç–µ—Ä–∏–∞–ª—ã –ø–æ —Ä–∞–∑–≤–∏—Ç–∏—é** - https://www.ihearyou.ru/\n‚Ä¢ **–ò—Å—Ç–æ—Ä–∏–∏ —Å–µ–º–µ–π** - https://www.ihearyou.ru/\n‚Ä¢ **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–ª—É—Ö–∞ –æ–Ω–ª–∞–π–Ω** - https://www.ihearyou.ru/\n\n**–ö–æ–Ω—Ç–∞–∫—Ç—ã –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏:**\nüìû +7 911 282 48 55\nüìû +7 921 930 78 63\nüìß info@ihearyou.ru\n\n–ü–æ–¥—Ä–æ–±–Ω–µ–µ: https://www.ihearyou.ru/",
            },
            {
                "title": "–Ø –≤–æ–ª–Ω—É—é—Å—å –æ —Å–≤–æ–µ–º —Å–ª—É—Ö–µ",
                "description": "–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–ª—è –≤–∑—Ä–æ—Å–ª—ã—Ö —Å –Ω–∞—Ä—É—à–µ–Ω–∏–µ–º —Å–ª—É—Ö–∞",
                "bot_message": "–ü–æ–Ω–∏–º–∞–Ω–∏–µ –≤–∞—à–∏—Ö –±–µ—Å–ø–æ–∫–æ–π—Å—Ç–≤. –î–∞–≤–∞–π—Ç–µ —Ä–∞–∑–±–µ—Ä–µ–º, —á—Ç–æ –≤–∞—Å –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç:",
                "content": "üë§ **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–ª—è –≤–∑—Ä–æ—Å–ª—ã—Ö**\n\n–ï—Å–ª–∏ –≤—ã –∑–∞–º–µ—á–∞–µ—Ç–µ –ø—Ä–æ–±–ª–µ–º—ã —Å–æ —Å–ª—É—Ö–æ–º, –≤–∞–∂–Ω–æ –¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å. –ù–∞ –Ω–∞—à–µ–º —Å–∞–π—Ç–µ –≤—ã –Ω–∞–π–¥–µ—Ç–µ:\n\n‚Ä¢ **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–ª—É—Ö–∞ –æ–Ω–ª–∞–π–Ω** - https://www.ihearyou.ru/\n‚Ä¢ **–ú–∞—Ç–µ—Ä–∏–∞–ª—ã –æ —Å–ª—É—Ö–µ** - https://www.ihearyou.ru/\n‚Ä¢ **–°–æ–≤–µ—Ç—ã –ø–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—é —Å–ª—É—Ö–∞** - https://www.ihearyou.ru/\n‚Ä¢ **–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–ª—É—Ö–æ–≤—ã—Ö –∞–ø–ø–∞—Ä–∞—Ç–∞—Ö** - https://www.ihearyou.ru/\n\n**–ö–æ–Ω—Ç–∞–∫—Ç—ã –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏:**\nüìû +7 911 282 48 55\nüìû +7 921 930 78 63\nüìß info@ihearyou.ru\n\n–ü–æ–¥—Ä–æ–±–Ω–µ–µ: https://www.ihearyou.ru/",
            },
        ]

        for item_data in main_items:
            # –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π –ø—É–Ω–∫—Ç –º–µ–Ω—é
            menu_item = MenuItem(
                title=item_data["title"],
                description=item_data["description"],
                bot_message=item_data["bot_message"],
                parent_id=None,
                is_active=True,
                access_level=AccessLevel.FREE,
            )
            session.add(menu_item)
            await session.flush()  # –ü–æ–ª—É—á–∞–µ–º ID

            # –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç
            content = ContentFile(
                menu_item_id=menu_item.id,
                content_type=ContentType.TEXT,
                content_text=item_data["content"],
                is_primary=True,
                sort_order=1,
            )
            session.add(content)

        await session.commit()
        print("‚úÖ –û—Å–Ω–æ–≤–Ω—ã–µ –ø—É–Ω–∫—Ç—ã –º–µ–Ω—é —Å–æ–∑–¥–∞–Ω—ã")

    async def create_child_subitems(self, session):
        """–°–æ–∑–¥–∞—Ç—å –ø–æ–¥—Ä–∞–∑–¥–µ–ª—ã –¥–ª—è –æ—Å–Ω–æ–≤–Ω—ã—Ö –ø—É–Ω–∫—Ç–æ–≤ –º–µ–Ω—é."""
        print("üìã –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–æ–≤...")

        # –ù–∞—Ö–æ–¥–∏–º ID –ø—É–Ω–∫—Ç–∞ "–Ø –≤–æ–ª–Ω—É—é—Å—å –æ —Å–ª—É—Ö–µ —Ä–µ–±–µ–Ω–∫–∞"
        child_item = await session.execute(
            select(MenuItem).where(MenuItem.title == "–Ø –≤–æ–ª–Ω—É—é—Å—å –æ —Å–ª—É—Ö–µ —Ä–µ–±–µ–Ω–∫–∞").limit(1)
        )
        child_item = child_item.first()
        if not child_item:
            print("‚ùå –ü—É–Ω–∫—Ç '–Ø –≤–æ–ª–Ω—É—é—Å—å –æ —Å–ª—É—Ö–µ —Ä–µ–±–µ–Ω–∫–∞' –Ω–µ –Ω–∞–π–¥–µ–Ω")
            return

        child_item = child_item[0]  # –ü–æ–ª—É—á–∞–µ–º –æ–±—ä–µ–∫—Ç –∏–∑ –∫–æ—Ä—Ç–µ–∂–∞

        child_subitems = [
            {
                "title": "–î–∏–∞–≥–Ω–æ–∑",
                "description": "–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–µ —Å–ª—É—Ö–∞ —É –¥–µ—Ç–µ–π",
                "bot_message": "–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–¥–µ–ª –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏:",
                "content": "üîç **–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Å–ª—É—Ö–∞ —É –¥–µ—Ç–µ–π**\n\n–î–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ —Å–ª—É—Ö–∞ —É –¥–µ—Ç–µ–π –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ:\n\n1. **–ê—É–¥–∏–æ–º–µ—Ç—Ä–∏—è** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ—Å—Ç—Ä–æ—Ç—ã —Å–ª—É—Ö–∞\n2. **–¢–∏–º–ø–∞–Ω–æ–º–µ—Ç—Ä–∏—è** - –æ—Ü–µ–Ω–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å—Ä–µ–¥–Ω–µ–≥–æ —É—Ö–∞\n3. **–†–µ—á–µ–≤–∞—è –∞—É–¥–∏–æ–º–µ—Ç—Ä–∏—è** - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–±–æ—Ä—á–∏–≤–æ—Å—Ç–∏ —Ä–µ—á–∏\n4. **–ò–≥—Ä–æ–≤–∞—è –∞—É–¥–∏–æ–º–µ—Ç—Ä–∏—è** - –¥–ª—è –¥–µ—Ç–µ–π –º–ª–∞–¥—à–µ–≥–æ –≤–æ–∑—Ä–∞—Å—Ç–∞\n\n–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø—Ä–æ—Ö–æ–¥–∏—Ç—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É —É —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞-—Å—É—Ä–¥–æ–ª–æ–≥–∞.\n\n–ü–æ–¥—Ä–æ–±–Ω–µ–µ: https://www.ihearyou.ru/",
            },
            {
                "title": "–°–ª—É—Ö–æ–≤—ã–µ –∞–ø–ø–∞—Ä–∞—Ç—ã",
                "description": "–í—Å—ë –æ —Å–ª—É—Ö–æ–≤—ã—Ö –∞–ø–ø–∞—Ä–∞—Ç–∞—Ö –¥–ª—è –¥–µ—Ç–µ–π",
                "bot_message": "–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–¥–µ–ª –æ —Å–ª—É—Ö–æ–≤—ã—Ö –∞–ø–ø–∞—Ä–∞—Ç–∞—Ö:",
                "content": "üéß **–°–ª—É—Ö–æ–≤—ã–µ –∞–ø–ø–∞—Ä–∞—Ç—ã –¥–ª—è –¥–µ—Ç–µ–π**\n\n**–¢–∏–ø—ã —Å–ª—É—Ö–æ–≤—ã—Ö –∞–ø–ø–∞—Ä–∞—Ç–æ–≤ –¥–ª—è –¥–µ—Ç–µ–π:**\n\n‚Ä¢ **–ó–∞—É—à–Ω—ã–µ (BTE)** - –º–æ—â–Ω—ã–µ, –ø–æ–¥—Ö–æ–¥—è—Ç –¥–ª—è —Ç—è–∂–µ–ª—ã—Ö –ø–æ—Ç–µ—Ä—å —Å–ª—É—Ö–∞\n‚Ä¢ **–í–Ω—É—Ç—Ä–∏—É—à–Ω—ã–µ (ITE)** - –∫–æ–º–ø–∞–∫—Ç–Ω—ã–µ, –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ\n‚Ä¢ **–í–Ω—É—Ç—Ä–∏–∫–∞–Ω–∞–ª—å–Ω—ã–µ (ITC)** - –Ω–µ–∑–∞–º–µ—Ç–Ω—ã–µ, –¥–ª—è –ª–µ–≥–∫–∏—Ö –ø–æ—Ç–µ—Ä—å\n\n**–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:**\n- –¶–∏—Ñ—Ä–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–≤—É–∫–∞\n- –®—É–º–æ–ø–æ–¥–∞–≤–ª–µ–Ω–∏–µ\n- –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –º–∏–∫—Ä–æ—Ñ–æ–Ω—ã\n- Bluetooth –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ\n\n–ü–æ–¥—Ä–æ–±–Ω–µ–µ: https://www.ihearyou.ru/",
            },
            {
                "title": "–û–±—É—á–µ–Ω–∏–µ –∏ —Ä–∞–∑–≤–∏—Ç–∏–µ",
                "description": "–ú–∞—Ç–µ—Ä–∏–∞–ª—ã –¥–ª—è –æ–±—É—á–µ–Ω–∏—è –∏ —Ä–∞–∑–≤–∏—Ç–∏—è –¥–µ—Ç–µ–π",
                "bot_message": "–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–¥–µ–ª –æ–±—É—á–µ–Ω–∏—è:",
                "content": "üìö **–û–±—É—á–µ–Ω–∏–µ –∏ —Ä–∞–∑–≤–∏—Ç–∏–µ –¥–µ—Ç–µ–π**\n\n**–≠—Ç–∞–ø—ã —Ä–∞–∑–≤–∏—Ç–∏—è —Ä–µ–±–µ–Ω–∫–∞ —Å –Ω–∞—Ä—É—à–µ–Ω–∏–µ–º —Å–ª—É—Ö–∞:**\n\n1. **–†–∞–Ω–Ω–µ–µ —Ä–∞–∑–≤–∏—Ç–∏–µ** - –æ—Ç 0 –¥–æ 3 –ª–µ—Ç\n2. **–î–æ—à–∫–æ–ª—å–Ω—ã–π –ø–µ—Ä–∏–æ–¥** - –æ—Ç 3 –¥–æ 7 –ª–µ—Ç\n3. **–®–∫–æ–ª—å–Ω—ã–π –≤–æ–∑—Ä–∞—Å—Ç** - –æ—Ç 7 –ª–µ—Ç\n\n**–ü–æ–ª–µ–∑–Ω—ã–µ —Å–æ–≤–µ—Ç—ã:**\n‚Ä¢ –ù–∞—á–∏–Ω–∞–π—Ç–µ —Å —Ç–∏—Ö–∏—Ö –∑–≤—É–∫–æ–≤\n‚Ä¢ –ü—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ—Å—å –≤ —á—Ç–µ–Ω–∏–∏ –ø–æ –≥—É–±–∞–º\n‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–ª—É—Ö–æ–≤–æ–π –∞–ø–ø–∞—Ä–∞—Ç –µ–∂–µ–¥–Ω–µ–≤–Ω–æ\n‚Ä¢ –†–µ–≥—É–ª—è—Ä–Ω–æ –ø–æ—Å–µ—â–∞–π—Ç–µ —Å—É—Ä–¥–æ–ª–æ–≥–∞\n\n–ü–æ–¥—Ä–æ–±–Ω–µ–µ: https://www.ihearyou.ru/",
            },
            {
                "title": "–ü–æ–º–æ—â—å —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞",
                "description": "–ü–æ–ª—É—á–∏—Ç–µ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é —ç–∫—Å–ø–µ—Ä—Ç–∞",
                "bot_message": "–ù—É–∂–Ω–∞ –ø–æ–º–æ—â—å –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª–∞?",
                "content": "üë®‚Äç‚öïÔ∏è **–ü–æ–º–æ—â—å —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞**\n\n–ù–∞—à–∏ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—ã –≥–æ—Ç–æ–≤—ã –ø–æ–º–æ—á—å –≤–∞–º:\n\n‚Ä¢ –ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ –ø–æ —Å–ª—É—Ö—É –¥–µ—Ç–µ–π\n‚Ä¢ –ü–æ–¥–±–æ—Ä —Å–ª—É—Ö–æ–≤—ã—Ö –∞–ø–ø–∞—Ä–∞—Ç–æ–≤\n‚Ä¢ –†–µ–∞–±–∏–ª–∏—Ç–∞—Ü–∏—è –ø–æ—Å–ª–µ –∫–æ—Ö–ª–µ–∞—Ä–Ω–æ–π –∏–º–ø–ª–∞–Ω—Ç–∞—Ü–∏–∏\n‚Ä¢ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–æ–¥–∏—Ç–µ–ª–µ–π\n\n**–ö–æ–Ω—Ç–∞–∫—Ç—ã:**\nüìû +7 911 282 48 55\nüìû +7 921 930 78 63\nüìß info@ihearyou.ru\n\n–ü–æ–¥—Ä–æ–±–Ω–µ–µ: https://www.ihearyou.ru/",
            },
        ]

        await self._create_subitems(session, child_item.id, child_subitems)
        print("‚úÖ –ü–æ–¥—Ä–∞–∑–¥–µ–ª—ã –¥–ª—è '–Ø –≤–æ–ª–Ω—É—é—Å—å –æ —Å–ª—É—Ö–µ —Ä–µ–±–µ–Ω–∫–∞' —Å–æ–∑–¥–∞–Ω—ã")

        # –ù–∞—Ö–æ–¥–∏–º ID –ø—É–Ω–∫—Ç–∞ "–Ø –≤–æ–ª–Ω—É—é—Å—å –æ —Å–≤–æ–µ–º —Å–ª—É—Ö–µ"
        adult_item = await session.execute(
            select(MenuItem).where(MenuItem.title == "–Ø –≤–æ–ª–Ω—É—é—Å—å –æ —Å–≤–æ–µ–º —Å–ª—É—Ö–µ").limit(1)
        )
        adult_item = adult_item.first()
        if not adult_item:
            print("‚ùå –ü—É–Ω–∫—Ç '–Ø –≤–æ–ª–Ω—É—é—Å—å –æ —Å–≤–æ–µ–º —Å–ª—É—Ö–µ' –Ω–µ –Ω–∞–π–¥–µ–Ω")
            return

        adult_item = adult_item[0]  # –ü–æ–ª—É—á–∞–µ–º –æ–±—ä–µ–∫—Ç –∏–∑ –∫–æ—Ä—Ç–µ–∂–∞

        adult_subitems = [
            {
                "title": "–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–ª—É—Ö–∞",
                "description": "–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–≤–æ–π —Å–ª—É—Ö",
                "bot_message": "–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–≤–æ–π —Å–ª—É—Ö –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å:",
                "content": "üîç **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–ª—É—Ö–∞ –æ–Ω–ª–∞–π–Ω**\n\n**–û–Ω–ª–∞–π–Ω-—Ç–µ—Å—Ç —Å–ª—É—Ö–∞:**\n\n‚Ä¢ **–ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞** - 5 –º–∏–Ω—É—Ç\n‚Ä¢ **–¢–æ—á–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã** - —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞\n‚Ä¢ **–ë–µ—Å–ø–ª–∞—Ç–Ω–æ** - –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π\n\n**–°–∏–º–ø—Ç–æ–º—ã –Ω–∞—Ä—É—à–µ–Ω–∏—è —Å–ª—É—Ö–∞:**\n‚Ä¢ –¢—Ä—É–¥–Ω–æ—Å—Ç–∏ –≤ –ø–æ–Ω–∏–º–∞–Ω–∏–∏ —Ä–µ—á–∏\n‚Ä¢ –ß–∞—Å—Ç—ã–µ –ø—Ä–æ—Å—å–±—ã –ø–æ–≤—Ç–æ—Ä–∏—Ç—å\n‚Ä¢ –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –≥—Ä–æ–º–∫–æ—Å—Ç–∏ —Ç–µ–ª–µ–≤–∏–∑–æ—Ä–∞\n‚Ä¢ –ü—Ä–æ–±–ª–µ–º—ã –≤ —à—É–º–Ω–æ–π –æ–±—Å—Ç–∞–Ω–æ–≤–∫–µ\n\n**–ü—Ä–æ–π–¥–∏—Ç–µ —Ç–µ—Å—Ç:** https://www.ihearyou.ru/\n\n–ü–æ–¥—Ä–æ–±–Ω–µ–µ: https://www.ihearyou.ru/",
            },
            {
                "title": "–°–ª—É—Ö–æ–≤—ã–µ –∞–ø–ø–∞—Ä–∞—Ç—ã",
                "description": "–í—Å—ë –æ —Å–ª—É—Ö–æ–≤—ã—Ö –∞–ø–ø–∞—Ä–∞—Ç–∞—Ö –¥–ª—è –≤–∑—Ä–æ—Å–ª—ã—Ö",
                "bot_message": "–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–¥–µ–ª –æ —Å–ª—É—Ö–æ–≤—ã—Ö –∞–ø–ø–∞—Ä–∞—Ç–∞—Ö:",
                "content": "üéß **–°–ª—É—Ö–æ–≤—ã–µ –∞–ø–ø–∞—Ä–∞—Ç—ã –¥–ª—è –≤–∑—Ä–æ—Å–ª—ã—Ö**\n\n**–¢–∏–ø—ã —Å–ª—É—Ö–æ–≤—ã—Ö –∞–ø–ø–∞—Ä–∞—Ç–æ–≤:**\n\n‚Ä¢ **–ó–∞—É—à–Ω—ã–µ (BTE)** - –º–æ—â–Ω—ã–µ, –ø–æ–¥—Ö–æ–¥—è—Ç –¥–ª—è —Ç—è–∂–µ–ª—ã—Ö –ø–æ—Ç–µ—Ä—å —Å–ª—É—Ö–∞\n‚Ä¢ **–í–Ω—É—Ç—Ä–∏—É—à–Ω—ã–µ (ITE)** - –∫–æ–º–ø–∞–∫—Ç–Ω—ã–µ, –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ\n‚Ä¢ **–í–Ω—É—Ç—Ä–∏–∫–∞–Ω–∞–ª—å–Ω—ã–µ (ITC)** - –Ω–µ–∑–∞–º–µ—Ç–Ω—ã–µ, –¥–ª—è –ª–µ–≥–∫–∏—Ö –ø–æ—Ç–µ—Ä—å\n‚Ä¢ **–ü–æ–ª–Ω–æ—Å—Ç—å—é –≤–Ω—É—Ç—Ä–∏–∫–∞–Ω–∞–ª—å–Ω—ã–µ (CIC)** - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ —Å–∫—Ä—ã—Ç—ã–µ\n\n**–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:**\n- –¶–∏—Ñ—Ä–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–≤—É–∫–∞\n- –®—É–º–æ–ø–æ–¥–∞–≤–ª–µ–Ω–∏–µ\n- –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –º–∏–∫—Ä–æ—Ñ–æ–Ω—ã\n- Bluetooth –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ\n\n–ü–æ–¥—Ä–æ–±–Ω–µ–µ: https://www.ihearyou.ru/",
            },
            {
                "title": "–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–ª—É—Ö–∞",
                "description": "–ö–∞–∫ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏ –∑–∞—â–∏—Ç–∏—Ç—å —Å–ª—É—Ö",
                "bot_message": "–£–∑–Ω–∞–π—Ç–µ, –∫–∞–∫ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–ª—É—Ö:",
                "content": "üõ°Ô∏è **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–ª—É—Ö–∞**\n\n**10 —Å–æ–≤–µ—Ç–æ–≤ –∫–∞–∫ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–ª—É—Ö:**\n\n1. **–ò–∑–±–µ–≥–∞–π—Ç–µ –≥—Ä–æ–º–∫–∏—Ö –∑–≤—É–∫–æ–≤**\n2. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∑–∞—â–∏—Ç–Ω—ã–µ –Ω–∞—É—à–Ω–∏–∫–∏**\n3. **–û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –≤—Ä–µ–º—è –≤ —à—É–º–Ω–æ–π —Å—Ä–µ–¥–µ**\n4. **–†–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Å–ª—É—Ö**\n5. **–ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤–∞—Ç–Ω—ã–µ –ø–∞–ª–æ—á–∫–∏**\n6. **–õ–µ—á–∏—Ç–µ —É—à–Ω—ã–µ –∏–Ω—Ñ–µ–∫—Ü–∏–∏**\n7. **–ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–π—Ç–µ —É—Ä–æ–≤–µ–Ω—å –≥—Ä–æ–º–∫–æ—Å—Ç–∏**\n8. **–î–µ–ª–∞–π—Ç–µ –ø–µ—Ä–µ—Ä—ã–≤—ã –≤ –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏–∏**\n9. **–ò–∑–±–µ–≥–∞–π—Ç–µ —Å—Ç—Ä–µ—Å—Å–∞**\n10. **–í–µ–¥–∏—Ç–µ –∑–¥–æ—Ä–æ–≤—ã–π –æ–±—Ä–∞–∑ –∂–∏–∑–Ω–∏**\n\n–ü–æ–¥—Ä–æ–±–Ω–µ–µ: https://www.ihearyou.ru/",
            },
            {
                "title": "–ü–æ–º–æ—â—å —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞",
                "description": "–ü–æ–ª—É—á–∏—Ç–µ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é —ç–∫—Å–ø–µ—Ä—Ç–∞",
                "bot_message": "–ù—É–∂–Ω–∞ –ø–æ–º–æ—â—å –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª–∞?",
                "content": "üë®‚Äç‚öïÔ∏è **–ü–æ–º–æ—â—å —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞**\n\n–ù–∞—à–∏ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—ã –≥–æ—Ç–æ–≤—ã –ø–æ–º–æ—á—å –≤–∞–º:\n\n‚Ä¢ –ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ –ø–æ —Å–ª—É—Ö—É\n‚Ä¢ –ü–æ–¥–±–æ—Ä —Å–ª—É—Ö–æ–≤—ã—Ö –∞–ø–ø–∞—Ä–∞—Ç–æ–≤\n‚Ä¢ –†–µ–∞–±–∏–ª–∏—Ç–∞—Ü–∏—è –ø–æ—Å–ª–µ –ø–æ—Ç–µ—Ä–∏ —Å–ª—É—Ö–∞\n‚Ä¢ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∏ –∞–¥–∞–ø—Ç–∞—Ü–∏—è\n\n**–ö–æ–Ω—Ç–∞–∫—Ç—ã:**\nüìû +7 911 282 48 55\nüìû +7 921 930 78 63\nüìß info@ihearyou.ru\n\n–ü–æ–¥—Ä–æ–±–Ω–µ–µ: https://www.ihearyou.ru/",
            },
        ]

        await self._create_subitems(session, adult_item.id, adult_subitems)
        print("‚úÖ –ü–æ–¥—Ä–∞–∑–¥–µ–ª—ã –¥–ª—è '–Ø –≤–æ–ª–Ω—É—é—Å—å –æ —Å–≤–æ–µ–º —Å–ª—É—Ö–µ' —Å–æ–∑–¥–∞–Ω—ã")

    async def _create_subitems(self, session, parent_id: int, subitems: List[Dict[str, Any]]):
        """–°–æ–∑–¥–∞—Ç—å –ø–æ–¥—Ä–∞–∑–¥–µ–ª—ã –¥–ª—è —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ –ø—É–Ω–∫—Ç–∞ –º–µ–Ω—é."""
        for subitem_data in subitems:
            # –°–æ–∑–¥–∞–µ–º –ø—É–Ω–∫—Ç –º–µ–Ω—é
            menu_item = MenuItem(
                title=subitem_data["title"],
                description=subitem_data["description"],
                bot_message=subitem_data["bot_message"],
                parent_id=parent_id,
                is_active=True,
                access_level=AccessLevel.FREE,
            )
            session.add(menu_item)
            await session.flush()  # –ü–æ–ª—É—á–∞–µ–º ID

            # –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç
            content = ContentFile(
                menu_item_id=menu_item.id,
                content_type=ContentType.TEXT,
                content_text=subitem_data["content"],
                is_primary=True,
                sort_order=1,
            )
            session.add(content)

        await session.commit()

    async def load_all_data(self):
        """–ó–∞–≥—Ä—É–∑–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ."""
        async with AsyncSessionLocal() as session:
            try:
                await self.clear_existing_data(session)
                await self.create_main_menu_items(session)
                await self.create_child_subitems(session)

                print("\nüéâ –í—Å–µ –¥–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã!")
                print("\nüìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:")
                print("‚Ä¢ –û—Å–Ω–æ–≤–Ω—ã—Ö —Ä–∞–∑–¥–µ–ª–æ–≤: 2")
                print("‚Ä¢ –ü–æ–¥—Ä–∞–∑–¥–µ–ª–æ–≤: 8")
                print("‚Ä¢ –í—Å–µ–≥–æ –ø—É–Ω–∫—Ç–æ–≤ –º–µ–Ω—é: 10")
                print("‚Ä¢ –ö–æ–Ω—Ç–µ–Ω—Ç–Ω—ã—Ö –±–ª–æ–∫–æ–≤: 10")

            except Exception as e:
                print(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö: {e}")
                await session.rollback()
                raise


async def main():
    """–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è."""
    print("üöÄ –ó–∞–ø—É—Å–∫ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å flow...")

    loader = FlowDataLoader()
    await loader.load_all_data()

    print("\n‚úÖ –ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!")


if __name__ == "__main__":
    asyncio.run(main())
