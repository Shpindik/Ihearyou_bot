# Bot

## Назначение
Асинхронный Telegram-бот на базе `aiogram 3`, который взаимодействует с пользователями, собирает их данные и сохраняет в Postgres. Интерфейс построен на инлайн-кнопках, часть из которых открывает WebApp со ссылками на материалы о слухе.

## Структура каталога
- `main.py` — точка входа. Загружает `.env`, проверяет наличие токена, настраивает логирование и запускает поллинг через `Dispatcher`.
- `handlers.py` — обработчики сообщений и callback-кнопок. Здесь описана логика диалогов и переключения клавиатур.
- `kb.py` — набор инлайн-клавиатур (главное меню, ветки диалога, WebApp-кнопки).
- `dict.py` — текстовые шаблоны и названия кнопок.
- `db.py` — сохранение сведений о пользователях в Postgres с помощью `asyncpg`.
- `states.py` — заготовка для FSM-состояний (пока пустая, но оставлена для будущих сценариев).
- `__pycache__/` — служебные файлы Python, не участвуют в логике.

## Поток обработки событий
1. Пользователь запускает `/start`. Бот сохраняет пользователя в БД и показывает главное меню.
2. По нажатию кнопок отправляются `callback_query`, которые попадают в соответствующие функции `handlers.py`.
3. Хэндлер обновляет текст сообщения и/или клавиатуру: например, ветка «Я волнуюсь о своём слухе» выводит пояснение и клавиатуру `self_hearing_keyboard`.
4. Кнопка «Проверить слух» отправляет текст с клавиатурой `check_hearing_links_keyboard`, содержащей WebApp-кнопки на тест и статью.
5. Все клавиатуры и тексты находятся в `kb.py` и `dict.py`, что упрощает поддержку контента.

## Переменные окружения
- `BOT_TOKEN` — токен Telegram-бота (обязательно).
- `POSTGRES_DB`, `POSTGRES_USER`, `POSTGRES_PASSWORD`, `DB_HOST`, `DB_PORT` — параметры подключения к БД.

Для работы необходима запущенная база Postgres и файл `.env` в корне репозитория с токеном бота и параметрами базы.

